<!DOCTYPE html>
<html lang="en" ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>FukushimaMuseum</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap-slider -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.1.0/css/bootstrap-slider.min.css">
    <!-- for canvas css -->
    <!-- <link href="cameraInput.css" rel="stylesheet"> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://hukumusume.com/jap/gazou/gazou_kensyou/hukusima.gif">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- chart js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <!-- bootstrap-slider -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.1.0/bootstrap-slider.min.js"></script>
    <!-- angular js -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.min.js"></script>
    <!-- Java script -->
    <script src="firstImpression.js"></script>
    <style type="text/css">
      canvas {
        height: auto !important;
        width:100% !important;
      }
    </style>
  </head>
  <body>
    <div id="header">
    </div>
    <div class="container">
      <h3 class="text-center" style="padding-bottom:10px;">Please Input Your First Impression</h1>
    </div>
    <div class="container">
      <div ng-controller="formCtrl as form">
        <form name="myForm" novalidate>
          <div class="form-horizontal">
            <div class="row">
              <canvas class="center-block" id="mycanvas" width="800" height="0" style="margin-bottom:10px;">Canvasに対応しているブラウザを使用して下さい。</canvas>
            </div>
            <div class="form-group">
              <div class="col-xs-12">
                <input class="form-control" type="file" accept="image/*" capture="camera" id="file-image">
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12">
                <canvas class="center-block" id="canvas" style="wdith:100%; height:100%;"></canvas>
              </div>
            </div>
            <div ng-repeat="item in form.items">
              <div class="form-group">
                <label for="clazz" class="col-xs-12">adj{{item.id}}</label>
                <div class="col-xs-12">
                  <ng-form name="formItem">
                    <input ng-attr-id="{{'ex'+item.id}}"
                      data-slider-id='ex1Slider'
                      type="text"
                      data-slider-min="0"
                      data-slider-max="10"
                      data-slider-step="1"
                      data-slider-value="5"
                      style="width:100%"
                      ng-change="form.change(formItem,$index);"
                      ng-model="item.num"
                      repeat-finished/>
                    <span ng-show="!formItem.$valid">1～10の間で入力して下さい。</span>
                  </ng-form>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="clazz" class="col-xs-12">Class</label>
              <div class="col-xs-12">
                <select id="clazz" class="form-control">
                  <option selected hidden>Please select</option>
                  <option>A</option>
                  <option>B</option>
                  <option>C</option>
                  <option>D</option>
                  <option>E</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="classNo" class="col-xs-12">No</label>
              <div class="col-xs-12">
                <select id="classNo" class="form-control">
                  <option selected hidden>Please select</option>
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="adjective" class="col-xs-12">Adjective</label>
              <div class="col-xs-12">
                <select id="adjective" class="form-control">
                  <option selected hidden>Please select</option>
                  <option>adjective1</option>
                  <option>adjective2</option>
                  <option>adjective3</option>
                  <option>adjective4</option>
                  <option>adjective5</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="memo" class="col-xs-12">Memo</label>
              <div class="col-xs-12">
                <input id="memo" type="text" class="form-control" placeholder="Feel Free To Write Here">
              </div>
            </div>
            <div class="form-group">
              <div class="col-xs-12">
                <!-- <input type="submit" class="btn btn-default" value="Submit" /> -->
                <a href="http://naoto24kawa.github.io/list.html" role="button" class="btn btn-primary btn-lg btn-block">submit</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <!-- Java Script -->
    <script src="cameraInput.js"></script>
    <script>
      var app = angular.module('app', []);
      app.controller('formCtrl', function () {
        //念の為thisを退避
        var me = this;
        //canvas取得
        var can = document.getElementById("canvas");
        var ctx = can.getContext("2d");
        // チャートの枠組み
        var radarChartData = {
        // 項目
        labels: ["A", "B", "C", "D", "E"],
        datasets: [
        {
         // 透明を使いたいのでRGBAで色を再現→rgba(xxx,xxx,xxx,0.5):透過度50%
         fillColor: "rgba(244,250,130,0.7)",  // チャート内の色
         strokeColor: "#111111",  // チャートを囲む線の色
         pointColor: "#111111",   // チャートの点の色
         pointStrokeColor: "#fff",    // 点を囲む線の色
         // 各項目の値
         data: []
         }]};

        //グラフの値
        me.items = [
          {num:5, id:1},
          {num:5, id:2},
          {num:5, id:3},
          {num:5, id:4},
          {num:5, id:5}
        ];

        //値を配列に入れ替えてから、Chart.jsへ渡す
        var addData = (function(){
          var arr = [];
          for(var i = 0; i<me.items.length; i++){
            arr.push(me.items[i].num);
          }
          return arr;
        }());
        radarChartData.datasets[0].data = addData;

        //グラフを生成
        var myChart = new Chart(ctx).Radar(radarChartData, {
         scaleShowLabels: false,  // 目盛を表示（true/false）
         pointLabelFontSize : 10, // ラベルのフォントサイズ
         scaleOverride : true, // 目盛の最大値を手動設定（true/false）
         scaleSteps : 10, // 目盛の数
         scaleStartValue : 0, // 目盛の最初の数
         scaleStepWidth : 1, // 目盛の間隔
         // 目盛の最大値の計算：scaleSteps（目盛の数）→5　scaleStepWidth（目盛の間隔）→2 だと5×2で最大値は10
         });

        //フォームの値に変更があったら
        me.change = function(formName,ind){
          //フォームにエラーが無いかチェック
          if(!formName.$valid)return false;
          //下記のプロパティを差し替えることによって、グラフを動的に変更できる
          myChart.datasets[0].points[ind].value = me.items[ind].num;
          //グラフ描画指示
          myChart.update();
        };
      });

      app.directive("repeatFinished", function($timeout){
        return function(scope, element, attrs){
          if (scope.$last){
            $timeout(function(){
              $('#ex1').slider({
                formatter: function(value) {
                  return value;
                }
              });
              $('#ex2').slider({
                formatter: function(value) {
                  return value;
                }
              });
              $('#ex3').slider({
                formatter: function(value) {
                  return value;
                }
              });
              $('#ex4').slider({
                formatter: function(value) {
                  return value;
                }
              });
              $('#ex5').slider({
                formatter: function(value) {
                  return value;
                }
              });
            });
          }
        }
      });
    </script>
    <style type="text/css">
      #ex1Slider .slider-selection {
        background: #BABABA;
      }
    </style>
  </body>
</html>
